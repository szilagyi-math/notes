% TeX format requirement
\NeedsTeXFormat{LaTeX2e}

% Package name [\RequirePackage{book-env}]
\ProvidesPackage{math-practise}

% This package provides all the packages to be included
% UTILITIES
\PassOptionsToPackage{magyar}{babel}
\RequirePackage{babel}
\RequirePackage{xparse}
\RequirePackage{xargs}
\RequirePackage{multicol}
\RequirePackage{afterpage}
\RequirePackage{booktabs}
\RequirePackage{qrcode}
\RequirePackage{lastpage}

% MATH
\RequirePackage{amsmath}
\RequirePackage[
  mathit = sym, mathup = sym, mathbf = sym,
  math-style = ISO, bold-style = ISO
]{unicode-math}
\RequirePackage{derivative}
\RequirePackage{xfrac}
% \RequirePackage{bm}

% FONT
\RequirePackage[stixtwo]{fontsetup}

% TABLE
\RequirePackage{array}
\RequirePackage{tabularx}

% GRAPHICS
\RequirePackage{graphicx}
\RequirePackage{tikz}
\RequirePackage{circuitikz}
\RequirePackage{pgfplots}
\pgfplotsset{compat=1.18}
\usetikzlibrary{calc, arrows.meta}
\usetikzlibrary{intersections, pgfplots.fillbetween, patterns, fadings, calc}
\usetikzlibrary{decorations.markings}
\usetikzlibrary{angles, quotes, 3d, perspective}

\pgfdeclarelayer{ft}
\pgfdeclarelayer{bg}
\pgfsetlayers{bg,main,ft}

% COLORS
\RequirePackage[table]{xcolor}
\RequirePackage{pagecolor}
\colorlet{primaryColor}{red!40!black}
\colorlet{secondaryColor}{cyan!40!black}
\colorlet{ternaryColor}{yellow!40!black}

% BOXES
\RequirePackage[most]{tcolorbox}
\RequirePackage[framemethod=tikz]{mdframed}

% Length declarations and page layout
\setlength\parindent{0pt}
\setlength\parskip{.66em}

\RequirePackage[
  margin=25mm,
  footskip=15mm,
  % showframe,
]{geometry}

\RequirePackage[
  headsepline=1mm:\textwidth,
  footsepline=1mm:\textwidth,
  olines,
]{scrlayer-scrpage}

\addtokomafont{disposition}{\color{primaryColor}}
\pagestyle{scrheadings}
\setkomafont{pageheadfoot}{\sffamily\color{gray}}
\ModifyLayer[addvoffset=-2mm]{scrheadings.foot.above.line}
\cfoot{\thepage\ / \pageref{LastPage}}
\ihead{\@subject (\@subjectCode)}
\ohead{\@area\ -- \@title}

\RequirePackage[
  luatex,
  colorlinks=true,
  linkcolor=primaryColor,
  urlcolor=black,
]{hyperref}

% Provided commands
\newcommand{\Reals}{\mathbb{R}}
\newcommand*{\dd}{\mathop{}\!\mathrm{d}}
\newcommand*{\iu}{{i\mkern1mu}}
\newcommand*{\Domain}{\mathcal{D}}
\newcommand*{\Range}{\mathcal{R}}
\newcommand{\rvec}[1]{\mathbfit{#1}}
\newcommand{\uvec}[1]{\hat{\mathbfit{#1}}}
\newcommand{\nvec}{\text{\textbf{\textit{0}}}}

% TODO: Fix these
\newcommand\ibase{\hat{\mathbfit{\imath}}}
\newcommand\jbase{\hat{\mathbfit{\jmath}}}
\newcommand\kbase{\hat{k}}

\NewDocumentCommand{\cisdeg}{s m}{%
  \IfBooleanTF{#1}{%
    \cos{#2}^\circ + \iu\sin{#2}^\circ%
  }{%
    \cos\left({#2}^\circ\right) + \iu\sin\left({#2}^\circ\right)%
  }%
}
\NewDocumentCommand{\rcisdeg}{s m m}{%
  \IfBooleanTF{#1}{%
    #2 \left(\cos{#3}^\circ + \iu\sin{#3}^\circ\right)%
  }{%
    #2 \left(\cos\left({#3}^\circ\right) + \iu\sin\left({#3}^\circ\right)\right)%
  }%
}
\NewDocumentCommand{\cisrad}{s m}{%
  \IfBooleanTF{#1}{%
    \cos{#2} + \iu\sin{#2}%
  }{%
    \cos\left({#2}\right) + \iu\sin\left({#2}\right)%
  }%
}
\NewDocumentCommand{\rcisrad}{s m m}{%
  \IfBooleanTF{#1}{%
    #2 \left(\cos{#3} + \iu\sin{#3}\right)%
  }{%
    #2 \left(\cos\left({#3}\right) + \iu\sin\left({#3}\right)\right)%
  }%
}

\DeclareMathOperator{\arccot}{arccot}
\DeclareMathOperator{\arcsinh}{arsinh}
\DeclareMathOperator{\arccosh}{arcosh}
\DeclareMathOperator{\arctanh}{artanh}
\DeclareMathOperator{\arccoth}{arcoth}
\DeclareMathOperator{\iRe}{Re}
\DeclareMathOperator{\iIm}{Im}
\DeclareMathOperator{\card}{card}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\inner}{int}


\newcommand{\area}[1]{\def\@area{#1}}
\newcommand{\docno}[1]{\def\@docno{#1}\setcounter{section}{#1}}
\renewcommand{\subject}[1]{\def\@subject{#1}}
\newcommand{\subjectCode}[1]{\def\@subjectCode{#1}}

% \let\maketitle\relax
\renewcommandx{\maketitle}[1][1=]{%
  \bgroup%
  \sffamily%
  \hspace*{.33em}
  \begin{tikzpicture}
    \node[fill=primaryColor, text=white, rounded corners=2mm, inner sep=3mm, scale=1.2, align=center] (docno) {%
      \Huge\bfseries\@docno\\[5mm]%
    };
    \node[text=primaryColor, anchor=north west, inner sep=3mm, scale=1.2, align=left] at ($(docno.north east)+(5mm,0)$) (title) {%
      \hspace*{-3mm}\huge\bfseries\@title\hspace*{-3mm}\\[-1.05em]%
    };
    \node[text=gray, anchor=south west, inner sep=0, align=left] at ($(docno.south east)+(5mm,1.5mm)$) (rest) {%
      \bfseries\@subject\ -- \@area\\[1mm]
      \bfseries\@date%
    };
    \draw[gray, ultra thick] ($(rest.south west)-(0,1.0mm)$) -- ($(rest.south east)-(0,1.0mm)$);
    \draw[gray, ultra thick] ($(rest.north west)+(0,1.5mm)$) -- ($(rest.north east)+(0,1.5mm)$);
  \end{tikzpicture}
  \egroup%
}

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
% ~~~~~~~~~~~~~~~~~~~~~ DEFINITION ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\mdfdefinestyle{definition}{%
  hidealllines=true,%
  leftline=true,%
  linewidth=3pt,%
  linecolor=primaryColor,%
  frametitlerule=true,%
  frametitlebackgroundcolor=primaryColor,%
  backgroundcolor=gray!10,
  frametitleaboveskip=2mm,
  frametitlebelowskip=2mm,
  innertopmargin=3mm,
}

\newcounter{definition}[section]
\numberwithin{definition}{section}
\newenvironment{definition}[1][\@nil]{%
  \def\rule@@color{primaryColor}%
  \refstepcounter{definition}%
  \begin{mdframed}[
      style=definition,
      nobreak=true,
      frametitle={
          \color{white}\sffamily\bfseries%
          Definíció~\thedefinition%
          \ifx\tmp\@nnil\else%
            : #1%
          \fi%
        }
    ]
    }{%
  \end{mdframed}
}

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
% ~~~~~~~~~~~~~~~~~~~~~ BLUEBOX ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

% \begin{noindent}
\mdfdefinestyle{blueBox}{%
  % NO LINES
  hidealllines=true,%
  leftline=true,%
  % COLORS
  backgroundcolor=cyan!10,%
  linecolor=secondaryColor,%
  % LENGTHS
  linewidth=3pt,%
  innertopmargin=.66em,%
  innerbottommargin=.66em,%
}
% \end{noindent}

\newcommand{\sftitle}[1]{{\bfseries\sffamily#1}}
\newenvironment{blueBox}{%
  \def\rule@@color{secondaryColor}%
  \begin{mdframed}[
      style=blueBox,
      nobreak=true,
    ]
    }{%
  \end{mdframed}
}

% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
% ~~~~~~~~~~~~~~~~~~~~~ NOTE ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
% ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

% \begin{noindent}
\mdfdefinestyle{note}{%
  % NO LINES
  hidealllines=true,%
  leftline=true,%
  % COLORS
  backgroundcolor=yellow!10,%
  linecolor=ternaryColor,%
  % LENGTHS
  linewidth=3pt,%
  innertopmargin=.66em,%
  innerbottommargin=.66em,%
}
% \end{noindent}

\newenvironment{note}{%
  \begin{mdframed}[
      style=note,
      nobreak=true,
    ]
    }{%
  \end{mdframed}
}

